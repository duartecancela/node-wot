# Smart Coffee Machine with MQTT Alerts ‚òï

Este projeto baseia-se na m√°quina de caf√© inteligente do reposit√≥rio [Eclipse Thingweb node-wot](https://github.com/eclipse-thingweb/node-wot), tendo sido estendido para emitir e detetar eventos via protocolo MQTT. O sistema permite simular a redu√ß√£o de n√≠veis de √°gua e notificar clientes sempre que o n√≠vel ficar abaixo de um limiar pr√©-definido.

## üß© Componentes do Projeto

-   **Produtor WoT (Thing)**: `smart-coffee-machine-mqtt.js`
    -   Exp√µe um _Thing_ WoT via HTTP
    -   Publica alertas MQTT no t√≥pico `coffee-machine/alert/water` sempre que o n√≠vel de √°gua fica inferior a 20%
-   **Consumidor MQTT (Client)**: `smart-coffee-consumer.js`
    -   Subscreve ao t√≥pico MQTT
    -   Simula redu√ß√£o do n√≠vel de √°gua por teclado ou aleatoriamente
    -   Apresenta notifica√ß√µes de alerta no terminal

---

## üöÄ Como correr o projeto

### 1. Pr√©-requisitos

-   Node.js instalado
-   Broker MQTT local (ex: Mosquitto)

### 2. Instalar depend√™ncias

Se estiver a trabalhar num projeto novo e ainda n√£o tiver as bibliotecas:

```bash
npm install @node-wot/core
npm install @node-wot/binding-http
npm install mqtt
```

Ou alternativamente, pode instalar todas de uma vez:

```bash
npm install @node-wot/core @node-wot/binding-http mqtt
```

---

### 3. Iniciar o broker Mosquitto

#### ‚úÖ Verificar se o Mosquitto est√° instalado

```bash
mosquitto -h
```

#### üÜö Ver vers√£o do Mosquitto

```bash
mosquitto -v
```

Se o comando n√£o for reconhecido, √© necess√°rio instalar o Mosquitto:

-   **Windows**: [https://mosquitto.org/download](https://mosquitto.org/download)
-   **Linux (Ubuntu/Debian)**:

```bash
sudo apt update
sudo apt install mosquitto mosquitto-clients
```

#### ‚ñ∂Ô∏è Iniciar Mosquitto manualmente (modo terminal)

```bash
mosquitto -v
```

#### ‚ñ∂Ô∏è Iniciar Mosquitto como servi√ßo (Linux)

```bash
sudo service mosquitto start
```

---

### 4. Executar o produtor

```bash
node examples/scripts/smart-coffee-machine-mqtt.js
```

-   O produtor ser√° exposto em: `http://localhost:8080/smart-coffee-machine`
-   O n√≠vel de √°gua √© reduzido via a√ß√£o `decreaseWater`
-   Se `waterLevel < 20`, √© publicado um alerta MQTT

---

### 5. Executar o consumidor

```bash
node examples/scripts/smart-coffee-consumer.js
```

-   Mostra um menu interativo para:
    -   Reduzir o n√≠vel manualmente
    -   Reduzir de forma aleat√≥ria
-   Publica e subscreve mensagens MQTT

---

## üîÅ Publicar e Subscrever via linha de comandos (CLI)

Caso se deseje testar os t√≥picos manualmente fora do sistema WoT, pode utilizar o cliente de consola `mosquitto_pub` e `mosquitto_sub`.

### ‚ñ∂Ô∏è Publicar uma mensagem:

```bash
mosquitto_pub -h localhost -t coffee-machine/alert/water -m "Manual test: water too low"
```

### üì° Subscrever a um t√≥pico:

```bash
mosquitto_sub -h localhost -t coffee-machine/alert/water
```

Estas ferramentas permitem validar facilmente o sistema e monitorizar os alertas em tempo real.
