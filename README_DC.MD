# Smart Coffee Machine with MQTT Alerts ‚òï

Este projeto baseia-se na m√°quina de caf√© inteligente do reposit√≥rio [Eclipse Thingweb node-wot](https://github.com/eclipse-thingweb/node-wot), tendo sido estendido para emitir e detetar eventos via protocolo MQTT. O sistema permite simular a redu√ß√£o de n√≠veis de √°gua e notificar clientes sempre que o n√≠vel ficar abaixo de um limiar pr√©-definido.

## üß© Componentes do Projeto

-   **Produtor WoT (Thing)**: `smart-coffee-machine-mqtt.js`
    -   Exp√µe um _Thing_ WoT via HTTP
    -   Publica alertas MQTT no t√≥pico `coffee-machine/alert/water` sempre que o n√≠vel de √°gua fica inferior a 20%
-   **Consumidor MQTT (Client)**: `smart-coffee-consumer.js`
    -   Subscreve ao t√≥pico MQTT
    -   Simula redu√ß√£o do n√≠vel de √°gua por teclado ou aleatoriamente
    -   Apresenta notifica√ß√µes de alerta no terminal

---

## üöÄ Como correr o projeto

### 1. Pr√©-requisitos

-   Node.js instalado
-   Broker MQTT local (ex: Mosquitto)
-   Depend√™ncias instaladas:

```bash
npm install @node-wot/core @node-wot/binding-http mqtt
```

### 2. Iniciar o broker Mosquitto

**Windows (com instala√ß√£o completa):**

```bash
mosquitto -v
```

**Linux (caso esteja instalado via apt):**

```bash
sudo service mosquitto start
```

---

### 3. Executar o produtor

```bash
node examples/scripts/smart-coffee-machine-mqtt.js
```

-   O produtor ser√° exposto em: `http://localhost:8080/smart-coffee-machine`
-   O n√≠vel de √°gua √© reduzido via a√ß√£o `decreaseWater`
-   Se `waterLevel < 20`, √© publicado um alerta MQTT

---

### 4. Executar o consumidor

```bash
node examples/scripts/smart-coffee-consumer.js
```

-   Mostra um menu interativo para:
    -   Reduzir o n√≠vel manualmente
    -   Reduzir de forma aleat√≥ria
-   Publica e subscreve mensagens MQTT

---

## üîÅ Publicar e Subscrever via linha de comandos (CLI)

Caso se deseje testar os t√≥picos manualmente fora do sistema WoT, pode utilizar o cliente de consola `mosquitto_pub` e `mosquitto_sub`.

### ‚ñ∂Ô∏è Publicar uma mensagem:

```bash
mosquitto_pub -h localhost -t coffee-machine/alert/water -m "Manual test: water too low"
```

### üì° Subscrever a um t√≥pico:

```bash
mosquitto_sub -h localhost -t coffee-machine/alert/water
```

Estas ferramentas permitem validar facilmente o sistema e monitorizar os alertas em tempo real.
