# Smart Coffee Machine with MQTT Alerts ‚òï

Este projeto baseia-se na m√°quina de caf√© inteligente do reposit√≥rio [Eclipse Thingweb node-wot](https://github.com/eclipse-thingweb/node-wot), tendo sido estendido para emitir e detetar eventos via protocolo MQTT. O sistema permite simular a redu√ß√£o de n√≠veis de √°gua e notificar clientes sempre que o n√≠vel ficar abaixo de um limiar pr√©-definido.

## üß© Componentes do Projeto

-   **Produtor WoT (Thing)**: `smart-coffee-machine-mqtt.js`
    -   Exp√µe um _Thing_ WoT via HTTP
    -   Publica alertas MQTT no t√≥pico `coffee-machine/alert/water` sempre que o n√≠vel de √°gua fica inferior a 20%
-   **Consumidor MQTT (Client)**: `smart-coffee-consumer.js`
    -   Subscreve ao t√≥pico MQTT
    -   Simula redu√ß√£o do n√≠vel de √°gua por teclado ou aleatoriamente
    -   L√™ a Thing Description (TD) e observa a propriedade `waterAlert` usando binding MQTT

---

## üöÄ Como correr o projeto

### 1. Pr√©-requisitos

-   Node.js instalado
-   Broker MQTT local (ex: Mosquitto)

### 2. Instalar depend√™ncias

```bash
npm install @node-wot/core @node-wot/binding-http @node-wot/binding-mqtt mqtt
```

---

### 3. Iniciar o broker Mosquitto

**Windows:**

```bash
mosquitto -v
```

**Linux:**

```bash
sudo service mosquitto start
```

---

### 4. Executar o produtor

```bash
node examples/scripts/smart-coffee-machine-mqtt.js
```

---

### 5. Executar o consumidor

```bash
node examples/scripts/smart-coffee-consumer.js
```

---

## üìò Uso de Binding Templates (MQTT)

Este projeto utiliza uma Thing Description (TD) com o protocolo MQTT, conforme os binding templates descritos pelo W3C.

A propriedade `waterAlert` est√° definida com:

-   `"op": ["observeproperty"]`
-   `"mqv:controlPacket": "PUBLISH"`
-   `"contentType": "application/json"`
-   Tipo: `object` com subpropriedade `"value": "string"`

---

## üì° Exemplo de mensagem publicada

As mensagens publicadas no t√≥pico `coffee-machine/alert/water` seguem agora este formato:

```json
{ "value": "Manual water alert: 8%" }
```

---

## üßæ Excerto da Thing Description (TD)

```json
"waterAlert": {
  "type": "object",
  "observable": true,
  "properties": {
    "value": { "type": "string" }
  },
  "forms": [
    {
      "href": "mqtt://localhost:1883/coffee-machine/alert/water",
      "op": ["observeproperty"],
      "contentType": "application/json",
      "mqv:controlPacket": "PUBLISH"
    }
  ]
}
```
